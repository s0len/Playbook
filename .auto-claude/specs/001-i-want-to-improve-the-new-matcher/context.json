{
  "task_description": "Fix NBA Sports Matcher - Require Both Teams to Match",
  "scoped_services": ["main"],
  "files_to_modify": {
    "main": [
      "src/playbook/team_aliases.py",
      "src/playbook/matcher.py",
      "src/playbook/parsers/structured_filename.py",
      "tests/test_matcher.py",
      "tests/test_structured_matcher.py"
    ]
  },
  "files_to_reference": [
    "src/playbook/team_aliases.py",
    "src/playbook/matcher.py",
    "tests/test_matcher.py",
    "tests/test_structured_matcher.py"
  ],
  "patterns": {
    "team_alias_structure": "Dict[str, Iterable[str]] where key is canonical team name, value is list of aliases (short name, city, abbreviation)",
    "alias_map_registration": "Add to _TEAM_ALIAS_MAPS dict with key like 'nba'",
    "scoring_function": "_score_structured_match() evaluates team tokens and date proximity",
    "test_class_pattern": "TestClassName with method names like test_specific_behavior()",
    "episode_factory": "_episode() helper function creates test episodes with date and aliases"
  },
  "existing_implementations": {
    "nhl_aliases": {
      "file": "src/playbook/team_aliases.py",
      "pattern": "_NHL_TEAM_SYNONYMS dictionary with 32 NHL teams"
    },
    "epl_aliases": {
      "file": "src/playbook/team_aliases.py",
      "pattern": "_EPL_TEAM_SYNONYMS dictionary with Premier League teams"
    },
    "date_proximity": {
      "file": "src/playbook/matcher.py",
      "pattern": "_dates_within_proximity() with 2-day tolerance"
    },
    "structured_scoring": {
      "file": "src/playbook/matcher.py",
      "pattern": "_score_structured_match() with date (+0.4) and team (+0.55) bonuses"
    }
  },
  "investigation_findings": {
    "root_cause": "matcher.py lines 662-664: partial team overlap gives score 0.35+0.05*len instead of 0.0",
    "bug_example": "'Indiana Pacers vs Boston Celtics' matches 'Boston Celtics vs Miami Heat' because 'celtics' overlaps",
    "solution": "Require structured_tokens == episode_tokens for full team match, score 0.0 for partial"
  },
  "tech_stack": {
    "language": "Python 3.14",
    "dependencies": ["rapidfuzz", "python-dateutil"],
    "testing": "pytest",
    "linting": "ruff (implied by pyproject.toml patterns)"
  },
  "created_at": "2026-01-02T18:36:27.099169",
  "updated_at": "2026-01-02T19:00:00.000000"
}
